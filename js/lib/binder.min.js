/**
 * Binder.js
 * version: v0.0.3
 * https://github.com/nekman/Binder.js
 * MIT
 * Tue Aug 19 2014 23:18:32 GMT+0200 (CEST)
 * Generated with Require.js and amdclean.
 * Object.observe polyfill from https://github.com/jdarling/Object.observe is included.
 */
!function(e,t){"object"==typeof exports?exports.Binder=t():"function"==typeof define&&define.amd?define(t):e.Binder=t()}(this,function(){var e=function(){var e={INPUT:!0,TEXTAREA:!0,OPTION:!0},t={ELEMENT_NODE:1,ATTRIBUTE_NODE:2},n={"&":"&amp;","<":"&lt;",">":"&gt;"},r=function(n){return e[n.tagName]||n.nodeType===t.ATTRIBUTE_NODE?"value":"innerHTML"};return{val:function(e,t){var n=e[r(e)];return void 0===t?n:void(e[r(e)]=this.replaceHTML(t))},replaceHTML:function(e){return"string"!=typeof e?e:e.replace(/[&<>]/g,function(e){return n[e]||e})},wrap:function(e,t){for(var n=t||document.createElement("div");e.firstChild;)n.appendChild(e.firstChild);return e.appendChild(n),e},unwrap:function(e,t){var n=t||e.parentNode,r=document.createRange();return r.selectNodeContents(e),n.appendChild(r.extractContents())},capture:function(e){var t=e.parentNode,n=e.cloneNode(!0);return t.removeChild(e),{node:n,parentNode:t,insert:function(){var e=n.cloneNode(!0);return t.appendChild(e),e},remove:function(){t.removeChild(n)}}},attr:function(e,t,n){if(e){if(n)return void e.setAttribute(t,n);if("function"==typeof e.getAttribute)return e.getAttribute(t)}},hasAttr:function(e,t){return e?"function"!=typeof e.hasAttribute?!1:e.hasAttribute(t):!1},isAttr:function(e){return e.nodeType===t.ATTRIBUTE_NODE},isValueNode:function(t){return e[t.tagName]}}}(),t=function(){var e={};return e.slice=Array.prototype.slice,e.extend=function(t){return e.slice.call(arguments,1).forEach(function(e){if(e)for(var n in e)t[n]=e[n]}),t},e}(),n=function(){function e(e,n){this.scopes=n,this.settings=e,this.leftBracket=this.settings.brackets[0],this.rightBracket=this.settings.brackets[1],this.matcher=new RegExp(t(this.leftBracket)+"(.+?)"+t(this.rightBracket),"g")}var t=function(e){return"\\"+e.split("").join("\\")};return e.prototype={render:function(e,t){return e?(this.getPropertiesFromText(e).forEach(function(n){var r=n.split(".")[1],i=this.getModelValue(r||n,t);e=e.replace(this.leftBracket,"").replace(n,i).replace(this.rightBracket,"").trim()},this),e):""},getModelValue:function(e,t){if(t){if(!(e in t))return this.getModelValue(e,this.scopes.findBy(e));var n=t[e];return"function"==typeof n?n.apply(t,[]):n}},containsBrackets:function(e){return e&&e.trim().match(this.matcher)?!0:!1},getPropertiesFromText:function(e){var t=e.match(this.matcher);return t?t.map(function(e){return this.removeBrackets(e)},this):[]},removeBrackets:function(e){return e.replace(this.leftBracket,"","g").replace(this.rightBracket,"","g").trim()}},e}(),r=function(){function e(){this.scopes={}}return e.prototype={add:function(e,t){this.scopes[e]||(this.scopes[e]=t)},find:function(e,t){var n=this.scopes[e];return n&&t in n?n:this.scopes.root},findBy:function(e){for(var t in this.scopes){var n=this.scopes[t];if(e in n)return n}}},e}(),i={keyup:function(e,t,n){e.addEventListener("keyup",function(r){t[n].apply(t,[r,e,n])})},keydown:function(e,t,n){e.addEventListener("keydown",function(r){t[n].apply(t,[r,e,n])})},click:function(e,t,n){e.addEventListener("click",function(r){return n in t?void t[n].apply(t,[r,e,n]):void(t.$parent&&n in t.$parent&&t.$parent[n].apply(t,[r,e,n]))})},show:function(e,t,n){e.style.display=t[n]===!0?"":"none"},disabled:function(e,t,n){e.disabled=t[n]},checked:function(e,t,n){e.checked=t[n],e.addEventListener("change",function(){t[n]=e.checked})},contenteditable:function(e,t,n,r){e.setAttribute("contenteditable",!0),e.addEventListener("input",function(){t[n]=r.val(e)})},select:function(e,t,n){e.addEventListener("change",function(){t[n]=this.options[this.selectedIndex].value})},selected:function(e,t,n){e.selected=t[n]===!0}},o=function(){function t(e){this.model=e,this.properties={}}var n=e;return t.prototype.addArray=function(e,t){return e.forEach(function(e){if(this.properties[e]||(this.properties[e]=[]),-1===this.properties[e].indexOf(t)){if(this.properties[e].push(t),!n.isValueNode(t))return;["keyup","change"].forEach(function(n){t.addEventListener(n,function(){this.handle(e,t)}.bind(this),!1)},this)}},this),this},t.prototype.add=function(e,t){return this.addArray([e],t),this},t.prototype.get=function(e){return this.properties[e]||[]},t.prototype.handle=function(e,t){return this.model[e]=n.val(t),this},t}(e),c=function(){var c=e,a=t,u=n,s=r,f=i,d=o;return{create:function(e,t){var n=new s,r=new u(e,n),i=function(e,t,r,a){var u=a||"root";if(n.add(u,t),v(e,"repeat"))return p(e,t,u),void o(c.wrap(e),t,r,u);p(e,t,u);var s=e.children,f=s.length;if(f)for(var d=0;f>d;d++)i(s[d],t,r);else l(e,t,u);e.isRoot&&(c.unwrap(e),e.parentNode.removeChild(e))},o=function(e,t,n){var r=e.children[0],o=v(e,"repeat")||"",a=o.split(" ")[1],u=t[a];if(!u)return void console.warn('Could not find any "%s" property to repeat in %o',o,e);var s={parent:e,children:[]},f=c.capture(r);y(t,f,new d(t).add(a,f)),y(u,f,new d(u)),u.forEach(function(e,o){var c=r.cloneNode(!0);e.$parent=t,e.$index=o,i(c,e,n,a),s.children.push(c)}),n&&n.push(s)},p=function(t,n,i){for(var o in f){var u=v(t,o);u&&(r.containsBrackets(u)&&(u=r.removeBrackets(u)),u&&f[o](t,n,u.split(".")[1]||u,c))}a.slice.call(t.attributes).filter(function(t){return t.value?r.containsBrackets(t.value)||new RegExp(e.prefix).test(t.name):!1}).forEach(function(e){e.value="value"!==e.name?h(e,e.value,n,i,t):h(t,e.value,n,i)})},l=function(e,t,n){var i=e.innerHTML;r.containsBrackets(i)&&(e.innerHTML=h(e,i,t,n))},h=function(e,t,i,o,a){var u=r.getPropertiesFromText(t),s=r.render(t,i),f=u.map(function(e){var t=e.split(".")[1];if(t&&t in i)return{propertyName:t,model:i};if(e in i)return{propertyName:e,model:i};var r=n.find(o,e);return r?{propertyName:e,model:r}:void 0}).filter(function(e){return void 0!==e}),p=new d(i).addArray(f.map(function(e){return e.propertyName}),e);return f.forEach(function(t){y(t.model,e,p,t.propertyName,a)}),c.replaceHTML(s)},v=function(t,n,r){return c.attr(t,e.prefix+n,r)},g={"delete":function(e,n,r){var i;if(i="number"==typeof n?n:parseInt(n,10),!isNaN(i)){var o=e.parentNode.children[i];o&&o.parentNode.removeChild(o),t.trigger("change",[r,n,e])}},add:function(e,n,r){var o=parseInt(n,10),c=e.insert();if(c.isRoot=!0,isNaN(o))i(c,r);else{var a=r[o];a.$parent=r,a.$index=o,i(c,a)}t.trigger("change",[r,n,e])},update:function(n,i,o,a,u,s){a.get(i).forEach(function(n){var a=s.oldValue,d=r.getModelValue(i,o);if(Array.isArray(d)&&Array.isArray(s.oldValue))return s.oldValue.forEach(function(){g.delete(n,0,s.oldValue)}),d.forEach(function(e,t){g.add(n,t,d)}),void t.trigger("arrayupdate",[o,i,n]);if(a!==d){if(c.isAttr(n)){var p=n.name.replace(e.prefix,"");if("function"==typeof f[p])return f[p](u,o,i,c),void t.trigger("change",[o,i,n])}c.val(n)!==d&&c.val(n,d),t.trigger("change",[o,i,n])}})}},y=function(e,t,n,r,i){var o=function(o){o.forEach(function(o){var c=o.name;("string"!=typeof r||r===c)&&g[o.type](t,c,e,n,i,o)})};Object.observe(e,o)};return{parseNode:i}}}}(e,t,n,r,i,o),a=function(){function e(){return{prefix:"bind-",brackets:["{{","}}"]}}var t=e();return t.defaults=e,t}(),u=function(){var n=c,r=e,o=a,u=i,s=t,f=function(e){return{trigger:function(t,n){e[t]&&e[t].forEach(function(e){e.apply(null,n)})}}},d=function(e,t){if(!e)throw new Error("rootNode is required");if(!t||"object"!=typeof t)throw new Error("Model is required");this.events={},this.repeatNodes=[],this.model=t,this.rootNode="function"==typeof window.jQuery&&e instanceof window.jQuery?e[0]:e,this.settings=o.defaults(),this.eventHandler=f(this.events)};d.prototype={options:function(e){return s.extend(this.settings,e),this},on:function(e,t){if(!String(e).length)throw new Error("Expected eventname to be a string!");if("function"!=typeof t)throw new Error("Expected callback to be a function!");return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this},trigger:function(e){return this.eventHandler.trigger(e,[this.model]),this},binders:function(e){return s.extend(u,e),this},bind:function(){for(var e=this.rootNode.children,t=e.length,i=n.create(this.settings,this.eventHandler),o=0;t>o;o++)i.parseNode(e[o],this.model,this.repeatNodes);return this.repeatNodes.length&&this.repeatNodes.forEach(function(e){e.children.forEach(function(t){r.unwrap(t,e.parent)})}),this.eventHandler.trigger("complete",[this.rootNode,this.model]),this}};var p=function(e,t){return new d(e,t)};return p.extend=s.extend,p.stringify=function(e,t){return JSON.stringify(e,function(e,t){return"$parent"!==e&&"$index"!==e?t:void 0},t||2)},p}(c,e,a,i,t);return u}),Object.observe||!function(e,t){function n(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}var r=function(e){var n=e.call(e),r=typeof r;return"object"==typeof t.alert?function(t){return n===e.call(t)||!!t&&typeof t.toString==r&&typeof t.valueOf==r&&/^\s*\bfunction\b/.test(""+t)}:function(t){return n===e.call(t)}}(e.prototype.toString),i=function(){return!!t.setImmediate}(),o=function(){return i?function(e){return setImmediate(e)}:function(e){return setTimeout(e,10)}}(),c=function(){return i?function(e){clearImmediate(e)}:function(e){clearTimeout(e)}}(),a=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},u=function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t},s=function(e){return"undefined"==typeof e?!1:"get"in e||"set"in e},f=function(e,t,n){if("object"!=typeof e)throw new TypeError("Object.observeObject called on non-object");if(r(t)===!1)throw new TypeError("Object.observeObject: Expecting function");if(Object.isFrozen(t)===!0)throw new TypeError("Object.observeObject: Expecting unfrozen function");if(void 0!==n&&!Array.isArray(n))throw new TypeError("Object.observeObject: Expecting acceptList in the form of an array")},d=function(){var e=[],t=function(t,n,r){f(t,n,r),r||(r=["add","update","delete","reconfigure","setPrototype","preventExtensions"]),Object.getNotifier(t).addListener(n,r),-1===e.indexOf(t)?e.push(t):Object.getNotifier(t)._checkPropertyListing()};t.prototype.deliverChangeRecords=function(e){Object.getNotifier(e).deliverChangeRecords()},e.lastScanned=0;var n=function(e){return function(){var t=0,r=e.length,i=new Date,c=!1;for(t=e.lastScanned;r>t&&!c;t++)Object.getNotifier(e[t])._checkPropertyListing(),c=new Date-i>100;e.lastScanned=r>t?t:0,o(n)}}(e);return o(n),t}(),p=function(e){var t=[],n=[],r=[],i=!1,f=[],d=[],p=this;Object.defineProperty(p,"_watching",{enumerable:!0,get:function(e){return function(){return e}}(e)});var l=function(e,t){var n=(typeof e[t],Object.getOwnPropertyDescriptor(e,t));if("getNotifier"===t||s(n)||!n.enumerable)return!1;if(e instanceof Array&&a(t)){var r=f.length;return f[r]=t,d[r]=e[t],!0}return function(t,n){f[t]=n,d[t]=e[n],Object.defineProperty(e,n,{get:function(){return d[t]},set:function(r){u(d[t],r)||(Object.getNotifier(e).queueUpdate(e,n,"update",d[t]),d[t]=r)}})}(f.length,t),!0};p._checkPropertyListing=function(e){var t,n,r,i,o,c=p._watching,u=Object.keys(c),s=0,h=u.length,v=f.slice(0),g=!e;for(c instanceof Array&&(o=c.length),s=0;h>s;s++)t=u[s],r=c[t],n=typeof r,-1===(i=f.indexOf(t))?l(c,t)&&g&&p.queueUpdate(c,t,"add",null,c[t]):(c instanceof Array&&a(t)&&d[i]!==r&&(g&&p.queueUpdate(c,t,"update",d[i],r),d[i]=r),v.splice(v.indexOf(t),1));if(c instanceof Array&&c.length!==o&&g&&p.queueUpdate(c,"length","update",o,c),g)for(h=v.length,s=0;h>s;s++)i=f.indexOf(v[s]),p.queueUpdate(c,v[s],"delete",d[i]),f.splice(i,1),d.splice(i,1)},p.addListener=function(e,r){var i=t.indexOf(e);-1===i?(t.push(e),n.push(r)):n[i]=r},p.removeListener=function(e){var r=t.indexOf(e);r>-1&&(t.splice(r,1),n.splice(r,1))},p.listeners=function(){return t},p.queueUpdate=function(e,t,n,r){this.queueUpdates([{type:n,object:e,name:t,oldValue:r}])},p.queueUpdates=function(e){var t,n=this,a=0,u=e.length||0;for(a=0;u>a;a++)t=e[a],r.push(t);i&&c(i),i=o(function(){i=!1,n.deliverChangeRecords()})},p.deliverChangeRecords=function(){var e=0,i=t.length;for(e=0;i>e;e++)if(t[e]){var o;if(n[e]){o=[];for(var c=0,a=r.length;a>c;c++)-1!==n[e].indexOf(r[c].type)&&o.push(r[c])}else o=r;o.length&&(t[e]===console.log?console.log(o):t[e](o))}r=[]},p.notify=function(t){if("object"!=typeof t||"string"!=typeof t.type)throw new TypeError("Invalid changeRecord with non-string 'type' property");t.object=e,p.queueUpdates([t])},p._checkPropertyListing(!0)},l=[],h=[];e.getNotifier=function(e){var t=h.indexOf(e),n=t>-1?l[t]:!1;return n||(t=h.length,h[t]=e,n=l[t]=new p(e)),n},e.observe=function(e,t,r){return n(e)?void 0:new d(e,t,r)},e.unobserve=function(e,t){f(e,t);var n=h.indexOf(e),r=n>-1?l[n]:!1;r&&(r.removeListener(t),0===r.listeners().length&&(h.splice(n,1),l.splice(n,1)))}}(Object,this);